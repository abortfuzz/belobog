# Belobog

The all-in-one type-guided fuzzing framework for the Move language.

**This repo contains a research artifact solely for evaluation purpose.** Movebit maintains another from-scratch implementation named as [movy](https://github.com/BitsLabSec/movy) with better maintainance. Checkout [movy](https://github.com/BitsLabSec/movy) if you would like to secure your smart contracts instead of research evaluation.

The preprint is available at [here](https://arxiv.org/abs/2512.02918) and under review.

## Docker

```
docker build -t belobog .
```

## Build

In most cases, simply do:

```
cargo build --release
```

Note `libclang` is required for `zstd-sys`.

## Usage

In general, there are two fuzzing workflows.

### Offchain Fuzzing

In this workflow, the source package is built, deployed and tested offline. Nothing really goes onchain.

Belobog by default enables the internal oracles like `earning profits`, `shl overflow` etc.

Additionaly, users are encouraged to provide extra oracles like [this](./crates/belobog/test-data/overflow_oracle/sources/overflow_oracle.move). Note this is an extra Move module designed to test [the target module](./crates/belobog/test-data/overflow/sources/overflow.move).

```move
public fun checked_shlw_wrapper(n: u256): (u256, bool) {
    let (res, has_overflow) = math_u256::checked_shlw(n);

    // The correct condition for overflow is if any of the top 64 bits are set.
    let expected_overflow = (n >> 192) != 0;

    if (has_overflow != expected_overflow) {
        oracle::crash_because(string::utf8(b"Incorrect overflow flag reported"));
    };

    if (expected_overflow) {
        if (res != 0) {
            oracle::crash_because(string::utf8(b"Result should be 0 on overflow"));
        }
    } else {
        if (res != (n << 64)) {
            oracle::crash_because(string::utf8(b"Result is incorrect in non-overflow case"));
        }
    };

    (res, has_overflow)
}
```

**Secret: The oracle itself was generated by Gemini! Stay tuned for our future work.**

The cli goes like:

```bash
./target/release/belobog-cli fuzz -n -o /tmp/out source -f ./path/to/overflow_oracle/
```

### Onchain Fuzzing

In this workflow, belobog will test an on-chain deployed package, with all on-chain states. Given the fact that smart contracts are stateful programs, not all bugs could be found within an offchain empty state.

`belobog` is capable of reproducing [cetus](https://cetusprotocol.notion.site/Cetus-Incident-Report-May-22-2025-Attack-Disclosure-1ff1dbf3ac8680d7a98de6158597d416) and [nemo](https://olivine-hydrofoil-637.notion.site/Nemo-Security-Incident-Cause-Process-and-Fund-Tracing-Report-V1-1-26a6b8723d8a80e29cb8cb48fe1390f2).

A sample of the command to reproduce [nemo] is:

```
RUST_LOG=info target/release/belobog-cli fuzz \
    -o seeds/nemo \
    -c db_nemo \
    --rpc http://127.0.0.1:8000/rpc \
    --privilege-functions 0x0f286ad004ea93ea6ad3a953b5d4f3c7306378b0dcc354c3f4ebb1d506d3b47f::py::get_sy_amount_in_for_exact_py_out,0x0f286ad004ea93ea6ad3a953b5d4f3c7306378b0dcc354c3f4ebb1d506d3b47f::market::swap_exact_pt_for_sy,0x0f286ad004ea93ea6ad3a953b5d4f3c7306378b0dcc354c3f4ebb1d506d3b47f::yield_factory::mint_py \
    --flash nemo,0x0f286ad004ea93ea6ad3a953b5d4f3c7306378b0dcc354c3f4ebb1d506d3b47f,0x467ce1e4351ff0e0dcdd7ab98ded8a0573c6acfb3ce10cb33bcfb2db06caca88,0x8dece5e84dbc98a90745bc11a97a0a215f36a98bf8f8b0c7b03bfc7139d2e424,0x3d04e2c6e2e22855ee8f4fe6fa6f01e13a5d1f161bc553298cc1c5cac0c5c9bb::sHAEDAL::SHAEDAL,32 \
    onchain -a 0xec4f1ffc3ae33792da03fc072ea80fedb44eb20d40ab08611c427e29247fbf2b,0x0f286ad004ea93ea6ad3a953b5d4f3c7306378b0dcc354c3f4ebb1d506d3b47f,0xee1ff66985a76b2c0170935fb29144b4007827ed2c4f3d6a1189578afb92bcdd \
    --object 0x4a8d13937be10f97e450d1b8eb5846b749f9d3f470243b6cfa660e3d75b1fc49:497676325,0x6:538834194,0xb9cc723bf7494325be2f3333a3fb72f46d53abe3603e3f326fc761287850db0e:497420735,0x949bec8393badf1042e7ab3f4803de16388bcb59a56690b3d74fc1ac8a82710a:560625922,0x07871c4b3c847a0f674510d4978d5cf6f960452795e8ff6f189fd2088a3f6ac7:7765848,0xa757975255146dc9686aa823b7838b507f315d704f428cbadad2f4ea061939d9:7765848,0xccd3898005a269c1e9074fe28bca2ff46784e8ee7c13b576862d9758266c3a4d:497420736,0xa7a2e0cfd15b47ee77434a0a6a0319cb7344a89f1f533c6b7ffc7fa326a2cb8f:586853067,0x56392aa1f849e901f4b9d0d313cdd02ab74543bbecb97708653051ab680cf281:497676324 \
    --struct-tags 0x3a304c7feba2d819ea57c3542d68439ca2c386ba02159c740f7b406e592c62ea::haedal::HAEDAL \
    -c 180415392
```

The onchain fuzzing is still under poblishing and [movy](https://github.com/BitsLabSec/movy) will make the command line much shorter by capturing these structs and objects automatically.

## Sui Fork

Unfortunately, Belobog relies on a fork of [Sui](https://github.com/wtdcode/sui) but we are actively merging these changes to the upstream.

## License

Please read our [licenese](./License.txt) before using `belobog`.

In short, `belobog` is licensed under GPL-v3 with additional terms below:

```
  Belobog is licensed under AGPL-v3 with a few additonal terms. By cloning
the code or running binaries compiled from Belobog (including modified source
code or copies as AGPL-v3 defines), you agree:

  * You are not using Belobog to do any live on-chain testing unless:
    * the smart contracts under testing is deployed by yourself,
    * or the owner of the smart contracts grant you permission to test.
  * Developers are not liable for any loss produced by Belobog.
  * The modified work shall not re-use the "Belobog" name and does not represent "Belobog".
  * The modified work shall contains all the rules above too.
  
  "Belobog" in this context refers to Belobog itself, as well as the modified
works defined in AGPL-v3.
  "Smart contracts" in this context refers to the Move modules.
  "On-chain" in this context refers to the deployed Move modlues, either on
test(dev) chains or main chains.
```

## Credits

Belobog is mainly brought by

- [Ziqiao Kong](https://github.com/wtdcode) and [Wanxu Xia](https://github.com/YsielX)
- [Shaohua Li](https://shao-hua-li.github.io/)

and inspired by several pioneering projects:

- [ityfuzz](https://github.com/fuzzland/ityfuzz)
- [sui-fuzzer](https://github.com/FuzzingLabs/sui-fuzzer)
- [historical-dev-inspect](https://github.com/kklas/historical-dev-inspect)